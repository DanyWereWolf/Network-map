# Карта локальной сети

Веб-приложение для визуализации и управления сетевой инфраструктурой на базе Яндекс.Карт. Одна карта на всех: данные и синхронизация через единый сервер.

## Возможности

- **Визуализация** — узлы, оптические кроссы, кабельные муфты, опоры связи и кабели на карте
- **Трассировка жил** — путь оптического волокна от узла до узла через муфты и кроссы
- **Редактирование** — добавление и удаление объектов, прокладка кабелей, соединение жил в кроссах и муфтах
- **Группы** — объединение нескольких кроссов или узлов в одной точке
- **Поиск** — по названию в шапке, центрирование на объекте
- **Экспорт / Импорт** — JSON; импорт из NetBox по API
- **Авторизация** — администратор (полный доступ) и пользователь (только просмотр)
- **История изменений** — журнал действий
- **Тема** — светлая и тёмная (интерфейс и подложка карты)
- **Синхронизация** — совместная работа в реальном времени (пооперационная, как Эсборд), курсоры участников
- **Хранение** — карта, пользователи, история, настройки на сервере (файл `data/store.json`)

## Быстрый старт

1. Установите зависимости: `npm install`
2. Запустите сервер: `npm run api` (порт 3000 по умолчанию)
3. Откройте в браузере **http://localhost:3000**
4. Войдите (по умолчанию: `admin` / `admin123`)
5. В блоке **Синхронизация** нажмите **Подключиться** — карта загрузится и будет синхронизироваться с сервером
6. Переключитесь в режим **Редактирование** для добавления объектов и прокладки кабелей

Без сервера приложение не работает: при открытии показывается предложение подключиться к серверу.

## Режимы и объекты

| Режим | Описание |
|-------|----------|
| **Просмотр** | Навигация, клик по объектам — информация и трассировка. Редактирование недоступно. |
| **Редактирование** | Добавление/удаление объектов, прокладка кабелей, соединение жил. Только для пользователей с правами редактора. |

| Тип объекта | Назначение |
|-------------|------------|
| Узел сети | Конечное устройство; подключаются жилы из кроссов |
| Оптический кросс | Соединение жил между кабелями и вывод на узлы |
| Кабельная муфта | Сращивание жил между кабелями |
| Опора связи | Транзитная точка (воздушные линии) |
| Кабель | Оптика 4/8/16/24 жилы или медь |

Добавление: в режиме редактирования выберите тип в боковой панели и кликните по карте. Прокладка кабеля: **Проложить кабель** → выберите тип → клик по двум объектам.

В карточке объекта (клик по объекту) доступны **Удалить** и **Дублировать** (в режиме редактирования). Очистка всей карты вынесена в блок **Опасные действия** внизу панели.

## Горячие клавиши

| Клавиша | Действие |
|---------|----------|
| `Escape` | Отмена текущей операции (режим размещения, прокладка кабеля) |
| `Ctrl+Z` | Отмена последнего действия (добавление/удаление объекта или кабеля) |

## Синхронизация

- Сервер: тот же процесс, что и REST API (`npm run api`). WebSocket: путь `/sync`, по умолчанию тот же хост (например `ws://localhost:3000/sync`).
- При подключении клиент получает текущее состояние карты; дальнейшие изменения передаются операциями (без перезагрузки всей карты).
- В блоке синхронизации отображается список «В сети»; на карте видны курсоры других участников.

Отдельный старый сервер только синхронизации: `npm run sync` (server.js) — для сценариев без REST API.

## Хранение данных

- Всё хранится на сервере в `data/store.json` (карта, пользователи, сессии, история, настройки).
- Запускайте один экземпляр сервера (`npm run api`). Резервная копия: **Экспорт** в приложении или копирование `data/store.json`.

### Настройка сервера

Скопируйте `server-config.example.json` в `server-config.json`. Параметры:

| Параметр | По умолчанию | Описание |
|----------|--------------|----------|
| `port` | 3000 | Порт |
| `host` | "0.0.0.0" | `0.0.0.0` — доступ по localhost и по IP в сети |

Переменные окружения `PORT` и `HOST` переопределяют файл.

## Структура проекта

```
├── index.html          # Главная страница
├── auth.html            # Страница входа
├── main.js              # Карта, объекты, кабели, UI
├── auth.js              # Авторизация
├── styles.css, auth.css # Стили
├── js/
│   ├── config.js        # Версия, репозиторий (для обновлений)
│   ├── utils.js         # escapeHtml, getObjectTypeName
│   ├── notifications.js # Уведомления (toast)
│   ├── updates.js       # Проверка обновлений
│   ├── help.js          # Справка
│   ├── history.js       # История изменений
│   └── sync.js          # WebSocket-синхронизация карты
├── server-api.js        # REST API + WebSocket /sync + раздача статики
├── server.js            # Отдельный WebSocket-сервер (npm run sync)
├── database.js          # Чтение/запись data/store.json
├── data/
│   └── store.json       # Карта, пользователи, история, настройки
├── server-config.example.json
├── README.md
├── BUILD.md             # Сборка защищённой версии (обфускация)
├── IMPROVEMENTS.md      # Идеи по доработке
├── POSSIBLE_ISSUES.md   # Известные ограничения
└── LICENSE
```

## Технологии

- Яндекс.Карты API 2.1
- JavaScript (без фреймворков)
- CSS-переменные (темы), тёмная подложка карты через CSS-фильтр
- Сервер: Express, WebSocket (ws), хранение в JSON

## Лицензия

Proprietary. Copyright (c) 2024–2026 Network-map. Подробнее см. [LICENSE](LICENSE).
