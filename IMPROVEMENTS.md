# Возможные улучшения проекта

Идеи по доработке. Часть уже реализована: индикатор «кто онлайн», курсоры участников, пооперационная синхронизация, тёмная тема для подложки карты.

---

## Безопасность

| Улучшение | Сложность | Описание |
|-----------|-----------|----------|
| **Надёжный хэш паролей** | Средняя | Заменить текущий хэш в `auth.js` и `server-api.js` на bcrypt или argon2 (npm-пакет). Хранить только хэш, проверять через `compare`. |
| **HTTPS в продакшене** | Низкая | Поднимать приложение за nginx/apache с TLS; сервер оставить на HTTP (localhost) или за reverse proxy. |
| **Ограничение попыток входа** | Низкая | На сервере считать неудачные логины по IP/username и временно блокировать или замедлять после N попыток. |
| **Смена пароля пользователем** | Низкая | Добавить API `PUT /api/auth/password` и форму «Сменить пароль» в профиле. |

---

## Удобство (UX)

| Улучшение | Сложность | Описание |
|-----------|-----------|----------|
| **Индикатор «Сохраняется»** | Низкая | При отправке состояния в синхронизацию показывать краткую подсказку «Синхронизировано» или «Сохранение…» в блоке синхронизации. |
| **Подтверждение перед выходом** | Низкая | При нажатии «Выйти» спрашивать «Вы уверены?», если на карте есть несохранённые изменения (если решите отслеживать «грязное» состояние). |
| **Восстановление пароля** | Высокая | Восстановление через email или одноразовую ссылку; нужна настройка почты или отдельный токен в БД. |
| **Подсказка при первом входе** | Низкая | Для новых пользователей показывать короткий туториал или подсказку «Подключите синхронизацию в боковой панели». |

---

## Производительность

| Улучшение | Сложность | Описание |
|-----------|-----------|----------|
| **Сжатие ответов API** | Низкая | В Express подключить `compression`: ответы JSON (карта, история) будут сжиматься. |
| **Ленивая загрузка истории** | Средняя | Не подгружать всю историю сразу; подгружать по страницам или последние N записей при открытии модалки. |
| **Виртуализация списков** | Средняя | В длинных списках (история, пользователи, результаты поиска) рендерить только видимые элементы. |
| **Дебаунс тяжёлых операций** | Низкая | При применении большого `applyRemoteState` разбивать на шаги с `requestAnimationFrame` или маленькими таймаутами, чтобы не блокировать UI. |

---

## Надёжность и данные

| Улучшение | Сложность | Описание |
|-----------|-----------|----------|
| **Автобэкап store.json** | Низкая | Перед каждой записью копировать текущий `store.json` в `data/backups/store-YYYY-MM-DD-HHmm.json` (или хранить последние N копий). |
| **Валидация данных карты** | Средняя | На сервере при приёме состояния проверять структуру (массив, ожидаемые поля у объектов) и отбрасывать некорректные данные. |
| **Логирование ошибок на сервере** | Низкая | Вместо пустых `catch (e) {}` писать `console.error(e)` или в файл; при желании — ротация логов. |
| **Проверка здоровья при старте** | Низкая | При запуске проверять доступность папки `data/`, запись в store; выводить предупреждение при ошибке. |

---

## Синхронизация

| Улучшение | Сложность | Описание |
|-----------|-----------|----------|
| **Версионирование состояния** | Высокая | Хранить версию (timestamp) у состояния; при конфликте показывать предупреждение или предлагать объединение. |
| **Уведомление о конфликте** | Средняя | Если пришли данные с сервера при неотправленных локальных изменениях — показать предупреждение с выбором действия. |

---

## Код и поддержка

| Улучшение | Сложность | Описание |
|-----------|-----------|----------|
| **Единая версия** | Низкая | Версию брать из одного места (например `package.json` или `config.js`) и при сборке/старте подставлять в фронт, чтобы не править в двух файлах. |
| **Обработка ошибок API** | Низкая | В `fetch` на клиенте обрабатывать не только `!r.ok`, но и сетевые ошибки; показывать пользователю сообщение («Нет связи», «Ошибка сервера»). |
| **Типы (TypeScript) или JSDoc** | Высокая | Постепенно добавлять типы или JSDoc для ключевых функций и структур данных — проще рефакторить и искать баги. |
| **Тесты** | Средняя | Юнит-тесты для `database.js`, проверка парсинга карты; e2e для логина и загрузки карты (например Playwright). |

---

## Функциональность

| Улучшение | Сложность | Описание |
|-----------|-----------|----------|
| **Роли с градацией** | Средняя | Не только «админ» и «пользователь», но и роли вроде «редактор» (правка карты без управления пользователями). |
| **Аудит логина** | Низкая | В историю или отдельную таблицу писать «Пользователь X вошёл в систему» с датой и IP (если передавать с клиента). |
| **Экспорт истории** | Низкая | Кнопка «Скачать историю в CSV/JSON» в модалке истории. |

---

## Деплой и окружение

| Улучшение | Сложность | Описание |
|-----------|-----------|----------|
| **Docker** | Низкая | `Dockerfile` и `docker-compose.yml`: один образ с Node, запуск `node server-api.js`, монтирование `data/` для store.json. |
| **Переменная для секретов** | Низкая | Секрет сессии/ключ не в коде, а в `process.env.SESSION_SECRET`; при первом запуске генерировать и подсказывать добавить в .env. |
| **Health-check** | Низкая | Эндпоинт `GET /api/health` уже есть; в Docker или оркестраторе использовать его для проверки живости сервиса. |

---

Приоритет лучше задать по своим целям: быстрый выигрыш дают сжатие, логирование ошибок, автобэкап и индикатор синхронизации; для «продакшена» важны пароли (bcrypt), HTTPS и ограничение попыток входа.
