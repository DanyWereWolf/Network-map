# Возможные проблемы и ограничения

Краткий список того, что может пойти не так, и что уже сделано для снижения рисков.

---

## Уже учтено

- **Повреждение store.json при записи** — запись идёт во временный файл, затем переименование; при сбое основной файл не перезаписывается.
- **Обрыв WebSocket** — при разрыве связи клиент автоматически пытается переподключиться (до 10 попыток с паузой 2 с). После ручного «Отключиться» авто-переподключение не выполняется.
- **Очень большое сообщение синхронизации** — сервер игнорирует сообщения больше ~15 МБ, чтобы не перегружать память и канал.
- **Пустая карта от нового клиента** — первые 4 секунды после подключения состояние от нового клиента не записывается в БД и не рассылается остальным (чтобы не затереть общую карту).

---

## Синхронизация

- **Два пользователя правят одновременно** — побеждает последнее сохранённое состояние; конфликты не объединяются. Рекомендуется не редактировать один и тот же участок карты с двух мест одновременно.
- **Перезапуск сервера** — все клиенты теряют соединение; нужно снова нажать «Подключиться» или дождаться авто-переподключения (если был сохранён адрес).
- **Очень большая карта** (тысячи объектов) — сериализация и отправка могут занимать заметное время; возможны краткие подвисания интерфейса при применении состояния.

---

## Данные

- **Один процесс сервера** — `store.json` не предназначен для одновременной записи из нескольких процессов. Запускайте один экземпляр `npm run api`.
- **Резервная копия** — автоматического бэкапа нет. Имеет смысл периодически копировать `data/store.json` или использовать экспорт карты из приложения.
- **Сессии** — хранятся в `store.json`. После перезапуска сервера старые токены остаются до истечения срока (7 дней на сервере, 30 дней при «Запомнить меня»).

---

## Безопасность

- **Пароли** — используется простой хэш (для демо); для реальной эксплуатации нужен bcrypt/argon2 и хранение только хэшей.
- **HTTPS** — при доступе по сети рекомендуется прокси (nginx и т.п.) с TLS; сам сервер TLS не использует.
- **Доступ по IP** — при `host: 0.0.0.0` сервер доступен из локальной сети; при необходимости ограничьте фаерволом.

---

## Интерфейс и браузер

- **Расширения браузера** — сообщения вида `runtime.lastError: Receiving end does not exist` идут от расширений (например, Cursor), не от приложения; на работу карты не влияют.
- **Старые браузеры** — нужна поддержка ES5+, WebSocket, fetch; лучше использовать актуальные версии Chrome/Firefox/Edge.

---

При появлении конкретной ошибки или неожиданного поведения опишите шаги и сообщение — можно точечно доработать код или логику.
